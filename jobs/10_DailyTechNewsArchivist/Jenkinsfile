pipeline {
    agent any
    // ... 其他設定 ...

    stages {
        stage('1. Checkout') {
            steps {
                git branch: 'main', url: 'https://github.com/okm2629/jenkins.git'
            }
        }

        stage('2. Build Image') {
            steps {
                script {
                    // ▼ 重點：切換到你的專案資料夾 ▼
                    // 請確認 "jobs/10_DailyTechNewsArchivist" 是你 GitHub 上的真實路徑
                    dir('jobs/10_DailyTechNewsArchivist') {
                        // 因為已經進入資料夾，現在 "." 就代表該資料夾，能找到 Dockerfile 了
                        sh "docker build -t news-scraper:latest ."
                    }
                }
            }
        }

        stage('3. Run Scraper') {
            steps {
                script {
                    dir('jobs/10_DailyTechNewsArchivist') {
                        // 修改這裡：將 ${PWD} 改為 \$(pwd)
                        sh "docker run --rm -v \$(pwd):/app/data news-scraper:latest"
                        
                        // (除錯用) 加入這行確認檔案真的有產生
                        sh "ls -l *.csv" 
                    }
                }
            }
        }
        
        stage('4. Archive Results') {
             steps {
                 // ▼ 切換進去才能找到生成的 CSV ▼
                 dir('jobs/10_DailyTechNewsArchivist') {
                     archiveArtifacts artifacts: '*.csv', fingerprint: true
                 }
             }
        }
    }
}