pipeline {
    agent any
    // ... 其他設定 ...

    stages {
        stage('1. Checkout') {
            steps {
                git branch: 'main', url: 'https://github.com/okm2629/jenkins.git'
            }
        }

        stage('2. Build Image') {
            steps {
                script {
                    // ▼ 重點：切換到你的專案資料夾 ▼
                    // 請確認 "jobs/10_DailyTechNewsArchivist" 是你 GitHub 上的真實路徑
                    dir('jobs/10_DailyTechNewsArchivist') {
                        // 因為已經進入資料夾，現在 "." 就代表該資料夾，能找到 Dockerfile 了
                        sh "docker build -t news-scraper:latest ."
                    }
                }
            }
        }

        stage('3. Run Scraper') {
            steps {
                script {
                    // ▼ 這裡也要切換，因為 scraper.py 也在裡面 ▼
                    dir('jobs/10_DailyTechNewsArchivist') {
                        // 注意：掛載 Volume 時，我們需要掛載 "當前目錄"
                        // 在 dir() 區塊內，${PWD} 會指向子目錄
                        sh "docker run --rm -v ${PWD}:/app/data news-scraper:latest"
                    }
                }
            }
        }
        
        stage('4. Archive Results') {
             steps {
                 // ▼ 切換進去才能找到生成的 CSV ▼
                 dir('jobs/10_DailyTechNewsArchivist') {
                     archiveArtifacts artifacts: '*.csv', fingerprint: true
                 }
             }
        }
    }
}